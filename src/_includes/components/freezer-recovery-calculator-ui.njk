<form method="get" action="/can-i-refreeze-this/" data-freezer-recovery-form class="space-y-6">
  {% set fieldControl %}
  <select id="food_id" name="food_id" required aria-required="true" class="w-full rounded-xl border border-border bg-surfaceElevated px-3 py-2 text-sm">
    <option value="">Select a food</option>
    {% for food in foods.items %}
    <option
      value="{{ food.food_id }}"
      {% if freezerRecoveryContext.initialInput.food_id == food.food_id %}selected{% endif %}
    >
      {{ food.name }}
    </option>
    {% endfor %}
  </select>
  {% endset %}
  {% set fieldId = "food_id" %}
  {% set fieldLabel = "Food" %}
  {% include "components/ui-field.njk" %}

  {% set fieldControl %}
  <select id="thaw_state" name="thaw_state" required aria-required="true" class="w-full rounded-xl border border-border bg-surfaceElevated px-3 py-2 text-sm">
    <option
      value="partially_thawed"
      {% if freezerRecoveryContext.initialInput.thaw_state == "partially_thawed" %}selected{% endif %}
    >
      Partially thawed (ice crystals remain)
    </option>
    <option
      value="fully_thawed"
      {% if freezerRecoveryContext.initialInput.thaw_state == "fully_thawed" %}selected{% endif %}
    >
      Fully thawed
    </option>
  </select>
  {% endset %}
  {% set fieldId = "thaw_state" %}
  {% set fieldLabel = "Thaw state" %}
  {% include "components/ui-field.njk" %}

  {% set fieldControl %}
  <input
    id="internal_temp_f"
    name="internal_temp_f"
    type="number"
    step="0.1"
    value="{{ freezerRecoveryContext.initialInput.internal_temp_f }}"
    aria-describedby="internal-temp-help"
    class="w-full rounded-xl border border-border bg-surfaceElevated px-3 py-2 text-sm"
  />
  {% endset %}
  {% set fieldId = "internal_temp_f" %}
  {% set fieldLabel = "Estimated internal temperature (F)" %}
  {% set fieldHint = "Leave blank if unknown." %}
  {% include "components/ui-field.njk" %}

  <div class="grid gap-4 sm:grid-cols-2">
    {% set fieldControl %}
    <input
      id="thaw_hours"
      name="thaw_hours"
      type="number"
      min="0"
      value="{{ freezerRecoveryContext.initialInput.thaw_hours }}"
      required
      aria-required="true"
      class="w-full rounded-xl border border-border bg-surfaceElevated px-3 py-2 text-sm"
    />
    {% endset %}
    {% set fieldId = "thaw_hours" %}
    {% set fieldLabel = "Time thawed (hours)" %}
    {% set fieldHint = "" %}
    {% include "components/ui-field.njk" %}

    {% set fieldControl %}
    <input
      id="thaw_minutes"
      name="thaw_minutes"
      type="number"
      min="0"
      value="{{ freezerRecoveryContext.initialInput.thaw_minutes }}"
      required
      aria-required="true"
      class="w-full rounded-xl border border-border bg-surfaceElevated px-3 py-2 text-sm"
    />
    {% endset %}
    {% set fieldId = "thaw_minutes" %}
    {% set fieldLabel = "Additional minutes thawed" %}
    {% include "components/ui-field.njk" %}
  </div>

  <fieldset class="space-y-2 rounded-2xl border border-white/10 bg-white/5 p-4">
    <legend class="px-2 text-xs uppercase tracking-wide text-muted">Modifiers</legend>
    <label for="refrozen" class="inline-flex items-center gap-2 text-sm">
      <input
        id="refrozen"
        name="refrozen"
        type="checkbox"
        value="1"
        {% if freezerRecoveryContext.initialInput.refrozen %}checked{% endif %}
      />
      Food has already been refrozen
    </label>
    <label for="high_risk_consumer" class="inline-flex items-center gap-2 text-sm">
      <input
        id="high_risk_consumer"
        name="high_risk_consumer"
        type="checkbox"
        value="1"
        {% if freezerRecoveryContext.initialInput.high_risk_consumer %}checked{% endif %}
      />
      High-risk consumer (pregnant, elderly, immunocompromised)
    </label>
  </fieldset>

  {% set buttonVariant = "primary" %}
  {% set buttonType = "submit" %}
  {% set buttonLabel = "Check refreezing risk" %}
  {% include "components/ui-button.njk" %}
</form>

{% set cardVariant = "elevated" %}
{% set cardContent %}
<section aria-live="polite" data-freezer-recovery-results class="space-y-3">
  <h2>Result</h2>
  <p>
    Status:
    <strong data-freezer-recovery-status>{{ freezerRecoveryContext.initialResult.status }}</strong>
  </p>
  {% set badgeStatus = freezerRecoveryContext.initialResult.status %}
  {% include "components/ui-badge.njk" %}
  <p>
    Recommended action:
    <strong data-freezer-recovery-action>{{ freezerRecoveryContext.initialResult.recommendedAction }}</strong>
  </p>

  <h3>Explanation</h3>
  <ul data-freezer-recovery-reasons class="list-disc space-y-1 pl-5">
    {% for reason in freezerRecoveryContext.initialResult.reasons %}
    <li>{{ reason }}</li>
    {% endfor %}
  </ul>

  <h3>Conservative guidance assumptions</h3>
  <ul data-freezer-recovery-assumptions class="list-disc space-y-1 pl-5">
    {% for assumption in freezerRecoveryContext.initialResult.assumptions %}
    <li>{{ assumption }}</li>
    {% endfor %}
  </ul>
  <p>
    Read the <a href="/disclaimer/">disclaimer</a> before making food safety decisions.
  </p>
</section>
{% endset %}
{% include "components/ui-card.njk" %}

{% set affiliateBlock = {
  title: "Recommended tools (affiliate links)",
  products: freezerRecoveryContext.affiliateProducts,
  scenarioType: "freezer",
  status: freezerRecoveryContext.initialResult.status,
  hasDisclaimerAbove: true
} %}
{% include "components/affiliate-block.njk" %}

{% set selectedFood = foods.byId[freezerRecoveryContext.initialInput.food_id] %}
{% set cardVariant = "default" %}
{% set cardContent %}
<section data-freezer-next-scenario>
  <h2>Next scenario</h2>
  <p data-freezer-next-scenario-summary>
    {% if freezerRecoveryContext.initialResult.status == "USE_CAUTION" %}
    This result is cautious. Compare with sit-out guidance and conservative storage references.
    {% else %}
    Compare related safety scenarios to make conservative decisions.
    {% endif %}
  </p>
  <ul data-freezer-next-scenario-links class="list-disc space-y-1 pl-5">
    {% if freezerRecoveryContext.initialResult.status == "USE_CAUTION" %}
    {% if selectedFood %}
    <li>
      <a href="/food-left-out-calculator/?food_id={{ selectedFood.food_id }}">
        Food left out calculator for {{ selectedFood.name }}
      </a>
    </li>
    {% else %}
    <li><a href="/food-left-out-calculator/">Food left out calculator</a></li>
    {% endif %}
    <li><a href="/printable-food-storage-chart/">Printable food storage chart</a></li>
    <li><a href="/methodology/">Methodology</a></li>
    {% else %}
    <li><a href="/food-left-out-calculator/">Food left out calculator</a></li>
    <li><a href="/printable-food-storage-chart/">Printable food storage chart</a></li>
    <li><a href="/disclaimer/">Disclaimer</a></li>
    {% endif %}
  </ul>
</section>
{% endset %}
{% include "components/ui-card.njk" %}

{% if freezerRecoveryContext.adContext.enabled %}
{% set adSlot = {
  enabled: true,
  zone: "bottom_page"
} %}
{% include "components/ad-slot.njk" %}
{% endif %}

<script id="freezer-recovery-data" type="application/json">{{ freezerRecoveryContext.serialized | safe }}</script>
<script src="/assets/freezer-recovery-engine.js"></script>
<script src="/assets/js/freezer-recovery-calculator.js"></script>
